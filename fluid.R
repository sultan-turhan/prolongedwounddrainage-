fluid <- read.csv(file = ("fluid.csv"), sep = ";",  header = T)
library(caret)
library(caretEnsemble)
library(xgboost)
library(ggplot2)
library(pROC)
indexes = createDataPartition(fluid$DISCHARGE, p = .75, list = FALSE)
train = fluid[indexes, ]
test = fluid[-indexes, ]
methods = c('rf','wsrf','LogitBoost','xgbTree')
tc = trainControl(method = "cv", number = 5, repeats = 5, 
                  classProbs = TRUE, savePredictions = 'final')
models = caretList(as.factor(DISCHARGE)~., data = train, 
                   trControl = tc, methodList = methods,preProc = c("center", "scale"))
rf <- train(as.factor(DISCHARGE)~.,data=train, method = "rf", trControl = tc,preProc = c("center", "scale"))
importancerf<-varImp(rf)$importance
testrf <- predict(rf, test, prob=TRUE)
confusionMatrix(as.factor(test$DISCHARGE), testrf, positive='1',mode = "everything")
importancerf<-varImp(rf)$importance
plot(varImp(rf))
a <-as.factor(test$DISCHARGE)
b <- as.factor(testrf)
a <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1)
b <-c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1)
auc(a, b)
wsrf <- train(as.factor(DISCHARGE)~.,data=train, method = "wsrf", trControl = tc,preProc = c("center", "scale"))
testwsrf <- predict(wsrf, test, prob=TRUE)
confusionMatrix(as.factor(test$DISCHARGE), testwsrf, positive='1',mode = "everything")
a <-as.factor(test$DISCHARGE)
b <- as.factor(testwsrf)
a <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1)
b <-c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1)
auc(a, b)
LogitBoost <- train(as.factor(DISCHARGE)~.,data=train, method = "LogitBoost", trControl = tc,preProc = c("center", "scale"))
testLogitBoost <- predict(LogitBoost, test, prob=TRUE)
confusionMatrix(as.factor(test$DISCHARGE), testLogitBoost, positive='1',mode = "everything")
a <-as.factor(test$DISCHARGE)
b <- as.factor(testLogitBoost)
a <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1)
b <-c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1)
auc(a, b)
xgbTree <- train(as.factor(DISCHARGE)~.,data=train, method = "xgbTree", trControl = tc,preProc = c("center", "scale"))
importancexgb<-varImp(xgbTree)$importance
testxgbTree <- predict(xgbTree, test, prob=TRUE)
confusionMatrix(as.factor(test$DISCHARGE), testxgbTree, positive='1',mode = "everything")
importancerf<-varImp(xgbTree)$importance
plot(varImp(xgbTree))
a <-as.factor(test$DISCHARGE)
b <- as.factor(testxgbTree)
a <- c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1)
b <-c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1)
auc(a, b)
stack = caretStack(models, method="glm", trControl = tc,preProc = c("center", "scale"))
pred = predict(stack, test[,1:26])
cm = confusionMatrix(as.factor(test$DISCHARGE), pred,mode = "everything",positive='1')
print(cm)

